<div class="max-w-4xl mx-auto py-8 px-2 sm:px-4">
    <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">F1 2025 Season</h2>
    </div>

    {{#if highlightRace}}
    <div class="mb-12">
        <div class="text-center mb-4">
            <h3 class="text-2xl font-semibold text-gray-700">Next Race</h3>
        </div>
        {{#with highlightRace}}
            <a href="/race/{{id}}" class="block group">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                    <div class="flex flex-row">
                        <div class="flex-1 flex flex-col justify-between p-4 sm:p-6">
                            <div class="sm:mb-2">
                                <div class="flex sm:flex-row items-center justify-start space-x-1 sm:space-x-3">
                                    <img src="flags/{{flag}}" alt="{{name}}" class="h-5 sm:h-6 rounded shadow-sm object-cover">
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-900 group-hover:text-red-700 transition-colors">
                                            <span class="hidden sm:block">{{name}}</span>
                                            <span class="sm:hidden">{{shortName}}</span>
                                        </h3>
                                        <p class="text-gray-500">{{circuit}}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex sm:flex-col flex-row sm:items-start items-center gap-3 sm:gap-0">
                                <div class="flex items-center text-gray-700 justify-end">
                                    <svg class="w-5 h-5 mr-1 text-gray-400" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <span class="font-medium text-sm sm:text-base">{{formattedDate}}</span>
                                </div>

                                <div class="flex items-center text-gray-700 justify-end">
                                    <svg class="w-5 sh-5 mr-1 text-gray-400" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="font-medium text-sm sm:text-base">{{formattedTime}}</span>
                                </div>
                            </div>


                            <div class="flex items-center sm:justify-between justify-end">
                                <div
                                        class="hidden sm:flex items-center text-red-600 font-semibold group-hover:text-red-700 transition-colors">
                                    <span>View Details & Predict</span>
                                    <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </div>

                                {{#if hasResult}}
                                    <span class="px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-bold">
                                        Race ended
                                    </span>
                                {{else}}
                                    {{#if predictionsStarted}}
                                        {{#if predictionsEnded}}
                                            <span class="px-4 py-2 bg-orange-100 text-orange-800 rounded-full text-sm font-bold">
                                                Results soon
                                            </span>
                                        {{else}}
                                            <span class="px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-bold animate-pulse">
                                                Predict now!
                                            </span>
                                        {{/if}}
                                    {{else}}
                                        <span class="px-4 py-2 bg-gray-100 text-gray-800 rounded-full text-sm font-bold">
                                            {{#if (eq daysUntilRace 0)}}Today!{{else if (eq daysUntilRace 1)}}Tomorrow{{else}}In
                                                {{daysUntilRace}} days{{/if}}
                                        </span>
                                    {{/if}}
                                {{/if}}
                            </div>
                        </div>

                        <div class="flex items-center justify-center p-2 bg-gray-50 group-hover:bg-gray-100 transition-colors">
                            <div class="text-center">
                                <div class="bg-white rounded-xl p-1 shadow-sm group-hover:shadow-md transition-shadow">
                                    <img src="circuits/{{track_img}}" alt="{{name}} circuit" class="h-[96px] sm:h-[148px] object-contain mx-auto">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        {{/with}}
    </div>
    {{/if}}

    <div class="space-y-4 sm:space-y-6">
        {{#if previousRaces.length}}
        <div class="text-center mb-4 relative">
            <h3 class="text-xl font-semibold text-gray-600 bg-gray-100 inline-block px-4 relative z-10">Previous Races
            </h3>
            <div class="absolute inset-0 flex items-center justify-center -z-0 pt-1">
                <div class="w-full border-t border-gray-300"></div>
            </div>
        </div>
        {{/if}}

        {{#each previousRaces}}
        <div class="race-item transition-all duration-500 ease-in-out {{#if (gt @index 1)}}hidden opacity-0{{else}}opacity-100{{/if}}">
            <a href="/race/{{id}}" class="block group">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                    <div class="flex flex-row">
                        <div class="flex-1 p-4 sm:p-6 flex flex-col justify-between">
                            <div class="sm:mb-2">
                                <div class="flex sm:flex-row items-center justify-start space-x-1 sm:space-x-3">
                                    <img src="flags/{{flag}}" alt="{{name}}" class="h-5 sm:h-6 rounded shadow-sm object-cover">
                                    <div>
                                        <h3 class="sm:text-xl font-bold sm:font-semibold text-gray-900 group-hover:text-red-700 transition-colors">
                                            <span class="hidden sm:block">{{name}}</span>
                                            <span class="sm:hidden">{{shortName}}</span>
                                        </h3>
                                        <p class="text-gray-500">{{circuit}}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-end sm:justify-between justify-end sm:mt-2 sm:mt-0">
                                <div class="hidden sm:flex mt-4 flex items-center text-gray-500 group-hover:text-red-600 transition-colors">
                                    <span class="text-sm font-medium">View Details</span>
                                    <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </div>
                                <span class="px-2 sm:px-3 sm:py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">
                                    Race ended
                                </span>
                            </div>

                        </div>

                        <div class="flex items-center justify-center p-2 bg-gray-50 group-hover:bg-gray-100 transition-colors">
                            <div class="text-center">
                                <div class="bg-white rounded-xl p-1 shadow-sm group-hover:shadow-md transition-shadow">
                                    <img src="circuits/{{track_img}}" alt="{{name}} circuit" class="h-[58px] sm:h-[94px] object-contain mx-auto">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {{/each}}

        {{#if (gt previousRaces.length 2)}}
        <div class="text-center pt-4">
            <button id="showMoreBtn"
                class="group px-6 py-2 bg-white border border-gray-300 hover:border-red-500 hover:text-red-600 text-gray-600 font-medium rounded-full transition-all duration-300 shadow-sm hover:shadow">
                <span class="flex items-center">
                    Show more races
                    <svg class="w-4 h-4 ml-2 transform group-hover:translate-y-1 transition-transform" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </span>
            </button>
        </div>
        {{/if}}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const btn = document.getElementById('showMoreBtn');
        if (btn) {
            btn.addEventListener('click', function () {
                const hiddenItems = document.querySelectorAll('.race-item.hidden');
                hiddenItems.forEach(function (el) {
                    el.classList.remove('hidden');
                    // Small delay to allow display:block to apply before opacity transition
                    setTimeout(() => {
                        el.classList.remove('opacity-0');
                        el.classList.add('opacity-100');
                    }, 10);
                });
                this.closest('div').style.display = 'none';
            });
        }
    });
</script>